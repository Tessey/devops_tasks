---
  - name: Check Hostname
    command: hostname
    register: hname

  - debug: msg="{{ hname.stdout }}"

  - name: Give ownership for Jenkins
    shell: chown jenkins:jenkins /home/daniel_zaharchenk00/.ssh/petProj
#install packages
  - name: APT Update
    apt: update_cache=yes

  - name: Install Java jdk
    apt:
      pkg:
      - openjdk-8-jdk
      - openjdk-8-jre
      - python-pip

  - name: Upgrade boto
    shell: pip2 install -U boto

#install Jenkins
  - name: Import Jenkins Key
    apt_key:
      state: present
      key: https://jenkins-ci.org/debian/jenkins-ci.org.key*

  - name: Install Jenkins
    apt:
      name: jenkins
      state: 2.222.3

  - name: Start & Enable Jenkins
    systemd:
      name: jenkins
      state: started
      enabled: true

  - name: Add user jenkins to docker group
    user:
      name: jenkins
      groups: docker
      append: true

  - name: Allow OpenSSH
    ufw:
      rule: allow
      name: OpenSSH

  - name: Allow all access to tcp port 8080
    ufw:
      rule: allow
      port: '8080'
      proto: tcp

  - name: Enable UFW
    ufw:
      state: enabled
      #command: usermod -aG docker jenkins

#Restore Jenkins
  - name: Create backup directory
    file:
      path: /tmp/backup
      state: directory

  - name: Upload restore script
    copy:
      src: jenkins-restore.sh
      dest: /tmp/backup/jenkins-restore.sh
      mode: 0755

  - name: Download backup file from gcloud
    gc_storage:
      bucket:        '{{ bucket_name }}'
      object:        '{{ jenkins_backup_name }}'
      dest:          /tmp/backup/{{ jenkins_backup_name }}
      gs_access_key: '{{ gcloud_access_key }}'
      gs_secret_key: '{{ gcloud_secret_key }}'
      mode: get

  -  name: Restore jenkins home directory
     shell: /tmp/backup/jenkins-restore.sh /var/lib/jenkins /tmp/backup/{{ jenkins_backup_name }}

  - name: Restore ownership
    shell: chown jenkins.jenkins -R /var/lib/jenkins
...
